<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>WIKI Plus - –§–∞–Ω –ò–≥—Ä–∞</title>
  <style>
    body { 
      font-family: 'Segoe UI', sans-serif; display: flex; justify-content: center; align-items: center;
      min-height: 100vh; margin: 0; background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%); color: #333;
      transition: background 0.5s ease;
    }
    #quiz-container { 
      background: rgba(255, 255, 255, 0.95); padding: 25px; border-radius: 20px; 
      width: 420px; box-shadow: 0 10px 30px rgba(0,0,0,0.5); text-align: center; position: relative;
    }
    .hidden { display: none; }
    #notification {
      position: fixed; top: -100px; left: 50%; transform: translateX(-50%);
      background: #3478f6; color: white; padding: 15px 25px; border-radius: 10px;
      box-shadow: 0 5px 15px rgba(0,0,0,0.3); transition: 0.5s; z-index: 1000; font-weight: bold;
    }
    #p-avatar { 
      width: 70px; height: 70px; border-radius: 50%; margin: 0 auto 10px;
      background: #3478f6; display: flex; align-items: center; justify-content: center;
      color: white; font-size: 35px; border: 3px solid #fff;
    }
    .user-status {
      font-size: 11px; font-weight: bold; text-transform: uppercase;
      padding: 2px 8px; border-radius: 10px; background: #eee; color: #666;
      display: inline-block; margin-top: 2px;
    }
    .avatar-grid { display: grid; grid-template-columns: repeat(6, 1fr); gap: 5px; margin: 10px 0; }
    .avatar-item { font-size: 20px; cursor: pointer; padding: 5px; border-radius: 5px; background: white; border: 1px solid #ddd; }
    button { width: 100%; border: none; padding: 12px; cursor: pointer; border-radius: 8px; font-weight: bold; transition: 0.2s; margin-top: 8px; }
    .btn-main { background: #28a745; color: white; }
    .btn-shop { background: #ffc107; color: #333; }
    .btn-grey { background: #6c757d; color: white; }
    .btn-admin { background: #dc3545; color: white; }
    .answer-btn { background: white; border: 2px solid #3478f6; color: #333; font-size: 15px; }
    input[type="text"], input[type="number"] { width: 100%; padding: 12px; margin: 10px 0; border-radius: 8px; border: 2px solid #ddd; box-sizing: border-box; }
    .shop-scroll { max-height: 450px; overflow-y: auto; text-align: left; padding-right: 5px; }
    .shop-section-title { font-weight: bold; font-size: 12px; color: #888; margin: 15px 0 5px 0; text-transform: uppercase; border-bottom: 1px solid #eee; }
    .shop-item {
      display: flex; justify-content: space-between; align-items: center;
      padding: 10px; border: 1px solid #eee; border-radius: 8px; margin-bottom: 5px;
      cursor: pointer; font-size: 14px; background: white;
    }
    .shop-item b { color: #28a745; }
    .card-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px; margin-top: 10px; }
    .card-box { 
      padding: 8px; border-radius: 10px; text-align: center; font-size: 10px; 
      border: 2px solid #ddd; background: #f9f9f9; transition: 0.3s;
    }
    .donate-btn { background: #007bff; color: white; padding: 5px 10px; border-radius: 5px; font-size: 12px; }
    @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.03); } 100% { transform: scale(1); } }
  </style>
</head>
<body>

<div id="notification">–£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ</div>

<section id="quiz-container">
  <div id="auth-screen">
    <h2>üíé WIKI Plus - –§–∞–Ω –ò–≥—Ä–∞</h2>
    <input type="text" id="username-input" placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–∏–∫–Ω–µ–π–º">
    <button class="btn-main" onclick="login()">–í–æ–π—Ç–∏ –≤ –∏–≥—Ä—É</button>
  </div>

  <div id="game-screen" class="hidden">
    <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 10px;">
      <div style="text-align: left;">
        <b id="display-name" style="font-size: 18px;">---</b><br>
        <span id="display-status" class="user-status">–ù–æ–≤–∏—á–æ–∫</span>
      </div>
      <div style="text-align: right;">
        <span style="background: #e7f0ff; padding: 5px 10px; border-radius: 15px; color: #007bff; font-weight: bold;">
          üíé <span id="diamond-count">0</span>
        </span>
        <div id="passive-income-display" style="font-size: 10px; color: #28a745; margin-top: 5px;">+0/—Å–µ–∫</div>
      </div>
    </div>
    
    <div id="quiz-area" style="background: #fff; padding: 15px; border-radius: 15px; margin-bottom: 10px; border: 1px solid #eee;">
      <p id="question-text" style="font-size: 17px; font-weight: bold; margin-bottom: 15px;">–í–æ–ø—Ä–æ—Å</p>
      <div id="answer-options" style="display: flex; flex-direction: column; gap: 8px;"></div>
    </div>

    <button class="btn-shop" onclick="toggleScreen('shop-screen')">üõí –ú–∞–≥–∞–∑–∏–Ω –∏ –ö–∞—Ä—Ç–æ—á–∫–∏</button>
    <button class="btn-grey" onclick="toggleScreen('profile-screen')">üë§ –ü—Ä–æ—Ñ–∏–ª—å</button>
  </div>

  <div id="shop-screen" class="hidden">
    <h3>üõí –ú–∞–≥–∞–∑–∏–Ω WIKI Plus</h3>
    <div class="shop-scroll">
      
      <div class="shop-section-title">üíé –ü–û–ö–£–ü–ö–ê –ê–õ–ú–ê–ó–û–í (–î–û–ù–ê–¢)</div>
      <div class="shop-item" onclick="openDonateModal(1000000, 99, 1.49, 1.35)">
        <span>üí≥ –ü–∞–∫–µ—Ç: 1.000.000 üíé</span>
        <div class="donate-btn">–ö–£–ü–ò–¢–¨</div>
      </div>
      <div class="shop-item" onclick="openDonateModal(10000000, 499, 5.99, 5.50)">
        <span>üí≥ –ö–µ–π—Å: 10.000.000 üíé</span>
        <div class="donate-btn">–ö–£–ü–ò–¢–¨</div>
      </div>
      <div class="shop-item" onclick="openDonateModal(50000000, 1990, 24.99, 23.00)">
        <span>üí≥ –°–∫–ª–∞–¥: 50.000.000 üíé</span>
        <div class="donate-btn">–ö–£–ü–ò–¢–¨</div>
      </div>

      <div class="shop-section-title">üÉè –ì–ê–ß–ê-–ö–ê–†–¢–û–ß–ö–ò</div>
      <div class="shop-item" style="background: #fff9e6; border-color: #ffc107;" onclick="openCardPack()">
        <span>üì¶ <b>–ù–∞–±–æ—Ä –±–ª–æ–≥–µ—Ä–æ–≤</b></span> <b>100k üíé</b>
      </div>
      <div id="card-album" class="card-grid"></div>

      <div class="shop-section-title">üè≠ –ë–ò–ó–ù–ï–° (–ü–∞—Å—Å–∏–≤–Ω—ã–π –¥–æ—Ö–æ–¥)</div>
      <div class="shop-item" onclick="buyPassive(50000, 100)"><span>üñ• –í–∏–¥–µ–æ–∫–∞—Ä—Ç–∞ (+100/—Å–µ–∫)</span> <b>50k üíé</b></div>
      <div class="shop-item" onclick="buyPassive(250000, 600)"><span>üè¢ –û—Ñ–∏—Å –ê4 (+600/—Å–µ–∫)</span> <b>250k üíé</b></div>
      <div class="shop-item" onclick="buyPassive(1000000, 3000)"><span>üè¶ –ë–∞–Ω–∫ MrBeast (+3k/—Å–µ–∫)</span> <b>1M üíé</b></div>

      <div class="shop-section-title">üé® –ö–ê–°–¢–û–ú–ò–ó–ê–¶–ò–Ø</div>
      <div class="shop-item" onclick="buyItem('color', '#d4af37', 500000)"><span>üü° –ó–æ–ª–æ—Ç–æ–π –Ω–∏–∫</span> <b>500k üíé</b></div>
      <div class="shop-item" onclick="buyItem('prefix', 'WIKI VIP', 300000)"><span>üéñ –¢–∏—Ç—É–ª: WIKI VIP</span> <b>300k üíé</b></div>
      <div class="shop-item" onclick="buyItem('theme', 'linear-gradient(135deg, #1d976c, #93f9b9)', 200000)"><span>üåø –¢–µ–º–∞: –õ–µ—Å</span> <b>200k üíé</b></div>
    </div>
    <button class="btn-grey" onclick="toggleScreen('game-screen')" style="margin-top: 15px;">‚¨Ö –ù–∞–∑–∞–¥</button>
  </div>

  <div id="profile-screen" class="hidden">
    <div id="p-avatar">üë§</div>
    <h3 id="p-name">---</h3>
    <span id="p-status-label" class="user-status">–ù–æ–≤–∏—á–æ–∫</span>
    <div style="text-align: left; margin-top: 15px;">
      <small>–°–º–µ–Ω–∏—Ç—å –∞–≤–∞—Ç–∞—Ä:</small>
      <div class="avatar-grid" id="avatar-selector"></div>
    </div>
    <button id="admin-btn" class="btn-admin hidden" onclick="toggleScreen('admin-screen')">‚öô –ü–∞–Ω–µ–ª—å WIKI</button>
    <button class="btn-grey" onclick="toggleScreen('game-screen')">‚¨Ö –ù–∞–∑–∞–¥</button>
  </div>

  <div id="admin-screen" class="hidden">
    <h3 style="color: #dc3545;">‚öô –ê–¥–º–∏–Ω-—Ü–µ–Ω—Ç—Ä</h3>
    <input type="text" id="admin-target-user" placeholder="–ù–∏–∫–Ω–µ–π–º">
    <input type="number" id="admin-amount" placeholder="–ö–æ–ª-–≤–æ üíé">
    <button class="btn-main" onclick="adminTransfer()">–í—ã–¥–∞—Ç—å</button>
    <button class="btn-grey" onclick="toggleScreen('profile-screen')">–ù–∞–∑–∞–¥</button>
  </div>
</section>

<script>
let currentUser = null;
let currentQIndex = 0;
let shuffledQuestions = [];

const CARD_DATABASE = [
  { id: 1, name: "–í–ª–∞–¥ –ê4", rarity: "Common", img: "üìÑ" },
  { id: 2, name: "–ì–ª–µ–Ω—Ç", rarity: "Common", img: "üìÑ" },
  { id: 3, name: "–ú–∞—Ä—å—è–Ω–∞ –†–æ", rarity: "Common", img: "üéÄ" },
  { id: 4, name: "–í–∞–∑–∞—á–∫–∞", rarity: "Common", img: "üè∫" },
  { id: 5, name: "–ö–æ–º–ø–æ—Ç", rarity: "Rare", img: "üíé" },
  { id: 6, name: "–§–∏–∫—Å–ø–ª–µ–π", rarity: "Rare", img: "‚öô" },
  { id: 7, name: "–†–∞–π–º", rarity: "Rare", img: "üåà" },
  { id: 8, name: "–ö–∞–±–∞–Ω", rarity: "Rare", img: "üêó" },
  { id: 9, name: "–Æ–Ω–∏", rarity: "Rare", img: "ü¶Ñ" },
  { id: 10, name: "–ò–≤–∞–Ω–≥–∞–π", rarity: "Epic", img: "üåÄ" },
  { id: 11, name: "–ì—Ä–∞–¥—É—Å", rarity: "Epic", img: "üå°" },
  { id: 12, name: "–†—É–Ω—è", rarity: "Epic", img: "üß∏" },
  { id: 13, name: "–§–ª–∞—Å–∫–∞", rarity: "Epic", img: "üß™" },
  { id: 14, name: "–õ–æ–ª–æ–ª–æ—à–∫–∞", rarity: "Legendary", img: "üëì" },
  { id: 15, name: "–°–∫—Ä–µ—Ç—á", rarity: "Legendary", img: "üê±" }
];

const RARITY_COLORS = { "Common": "#b4b4b4", "Rare": "#3478f6", "Epic": "#a335ee", "Legendary": "#ff8000" };

const avatars = ["üë§", "üê±", "üê∂", "ü¶ä", "ü¶Å", "ü§ñ", "üíé", "üî•", "üöÄ", "üëë", "üëΩ", "üëæ"];
const quizData = [
  { q: "–ö—Ç–æ –∞–≤—Ç–æ—Ä —Ñ—Ä–∞–∑—ã ¬´–í—Å–µ–º –ø—Ä–∏–≤–µ—Ç, –º–µ–Ω—è –∑–æ–≤—É—Ç –ê4!¬ª?", a: ["–í–ª–∞–¥ –ë—É–º–∞–≥–∞", "–ì–ª–µ–Ω—Ç", "–ö–æ–±—è–∫–æ–≤"], correct: 0 },
  { q: "–ö—Ç–æ —Ä–∞–∑–¥–∞–µ—Ç –º–∏–ª–ª–∏–æ–Ω—ã –¥–æ–ª–ª–∞—Ä–æ–≤ –≤ —á–µ–ª–ª–µ–Ω–¥–∂–∞—Ö?", a: ["MrBeast", "PewDiePie", "Speed"], correct: 0 },
  { q: "–ö—Ç–æ –∂–∏–≤–µ—Ç –≤ ¬´–î–µ—Ä–µ–≤–Ω–µ –∂–∏—Ç–µ–ª–µ–π ‚Ññ13¬ª?", a: ["–ö–æ–º–ø–æ—Ç", "–≠–¥–∏—Å–æ–Ω", "–õ–æ–ª–æ–ª–æ—à–∫–∞"], correct: 0 },
  { q: "–í –∫–∞–∫–æ–π –∏–≥—Ä–µ —Å—Ç—Ä–æ—è—Ç –¥–æ–º–∞ –∏–∑ –∫—É–±–æ–≤?", a: ["Roblox", "Minecraft", "Brawl Stars"], correct: 1 },
  { q: "–ö–∞–∫ –∑–æ–≤—É—Ç —Å–æ–±–∞–∫—É –í–ª–∞–¥–∞ –ê4?", a: ["–ë—É—Å—è", "–ß–µ—Å—Å–∏", "–ú–∞—Ä—Ç–∞"], correct: 0 }
];

function notify(text) {
  const n = document.getElementById('notification');
  n.innerText = text; n.style.top = "20px";
  setTimeout(() => n.style.top = "-100px", 2500);
}

function login() {
  const name = document.getElementById('username-input').value.trim();
  if (!name) return;
  currentUser = name;
  let users = JSON.parse(localStorage.getItem('wiki_users')) || {};
  if (!users[currentUser]) {
    users[currentUser] = { diamonds: 0, avatar: "üë§", nickColor: "#333", cards: [], lastBonus: 0, passive: 0, prefix: null };
  }
  if (currentUser === "WIKI") document.getElementById('admin-btn').classList.remove('hidden');
  localStorage.setItem('wiki_users', JSON.stringify(users));
  initAvatarSelector();
  toggleScreen('game-screen');
  updateUI();
  startInfiniteQuiz();
}

// –¢–∞–π–º–µ—Ä –¥–ª—è –ø–∞—Å—Å–∏–≤–Ω–æ–≥–æ –¥–æ—Ö–æ–¥–∞
setInterval(() => {
  if (!currentUser) return;
  let users = JSON.parse(localStorage.getItem('wiki_users'));
  let user = users[currentUser];
  if (user.passive > 0) {
    user.diamonds += user.passive;
    localStorage.setItem('wiki_users', JSON.stringify(users));
    updateUI();
  }
}, 1000);

function updateUI() {
  let users = JSON.parse(localStorage.getItem('wiki_users'));
  let user = users[currentUser];
  
  if (user.bg) document.body.style.background = user.bg;
  document.getElementById('display-name').innerText = currentUser;
  document.getElementById('display-name').style.color = user.nickColor;
  document.getElementById('diamond-count').innerText = Math.floor(user.diamonds).toLocaleString();
  document.getElementById('p-name').innerText = currentUser;
  document.getElementById('p-avatar').innerText = user.avatar;
  document.getElementById('passive-income-display').innerText = `+${user.passive}/—Å–µ–∫`;
  
  const statusLabel = document.getElementById('display-status');
  const profileStatus = document.getElementById('p-status-label');
  const title = user.prefix || (user.diamonds > 1000000 ? "–ú–∏–ª–ª–∏–æ–Ω–µ—Ä" : "–ù–æ–≤–∏—á–æ–∫");
  statusLabel.innerText = title;
  profileStatus.innerText = title;

  renderAlbum();
}

// –§–£–ù–ö–¶–ò–Ø –î–û–ù–ê–¢–ê
function openDonateModal(amount, rub, usd, eur) {
  const choice = prompt(
    `–í—ã–±–µ—Ä–∏—Ç–µ –≤–∞–ª—é—Ç—É –¥–ª—è –æ–ø–ª–∞—Ç—ã ${amount.toLocaleString()} üíé:\n` +
    `1. –†—É–±–ª–∏ (${rub}‚ÇΩ)\n` +
    `2. –î–æ–ª–ª–∞—Ä—ã (${usd}$)\n` +
    `3. –ï–≤—Ä–æ (${eur}‚Ç¨)\n` +
    `–í–≤–µ–¥–∏—Ç–µ —á–∏—Å–ª–æ 1, 2 –∏–ª–∏ 3:`
  );

  if (choice === "1" || choice === "2" || choice === "3") {
    let users = JSON.parse(localStorage.getItem('wiki_users'));
    users[currentUser].diamonds += amount;
    localStorage.setItem('wiki_users', JSON.stringify(users));
    notify(`‚úÖ –£—Å–ø–µ—à–Ω–æ –Ω–∞—á–∏—Å–ª–µ–Ω–æ ${amount.toLocaleString()} üíé`);
    updateUI();
  } else if (choice !== null) {
    notify("‚ùå –ù–µ–≤–µ—Ä–Ω—ã–π –≤—ã–±–æ—Ä");
  }
}

function openCardPack() {
  let users = JSON.parse(localStorage.getItem('wiki_users'));
  let user = users[currentUser];
  if (user.diamonds < 100000) return notify("–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ üíé!");

  user.diamonds -= 100000;
  const rand = Math.random() * 100;
  let rarity = "Common";
  if (rand < 5) rarity = "Legendary";
  else if (rand < 20) rarity = "Epic";
  else if (rand < 50) rarity = "Rare";

  const pool = CARD_DATABASE.filter(c => c.rarity === rarity);
  const card = pool[Math.floor(Math.random() * pool.length)];

  if (!user.cards) user.cards = [];
  if (!user.cards.includes(card.id)) {
    user.cards.push(card.id);
    notify(`üéâ –ù–û–í–ê–Ø –ö–ê–†–¢–û–ß–ö–ê: ${card.name}!`);
  } else {
    notify(`üÉè –ü–æ–≤—Ç–æ—Ä–∫–∞: ${card.name} (+20–∫ üíé)`);
    user.diamonds += 20000;
  }
  localStorage.setItem('wiki_users', JSON.stringify(users));
  updateUI();
}

function renderAlbum() {
  let users = JSON.parse(localStorage.getItem('wiki_users'));
  let user = users[currentUser];
  const albumBox = document.getElementById('card-album');
  if (!albumBox) return;
  albumBox.innerHTML = "";
  
  CARD_DATABASE.forEach(card => {
    const has = user.cards && user.cards.includes(card.id);
    const el = document.createElement('div');
    el.className = "card-box";
    el.style.borderColor = has ? RARITY_COLORS[card.rarity] : "#ddd";
    el.style.opacity = has ? "1" : "0.4";
    if (has && card.rarity === "Legendary") el.style.animation = "pulse 2s infinite";
    el.innerHTML = `<div style="font-size:22px">${has ? card.img : '‚ùì'}</div><b>${has ? card.name : '???'}</b>`;
    albumBox.appendChild(el);
  });
}

function buyPassive(price, income) {
  let users = JSON.parse(localStorage.getItem('wiki_users'));
  if (users[currentUser].diamonds >= price) {
    users[currentUser].diamonds -= price;
    users[currentUser].passive = (users[currentUser].passive || 0) + income;
    localStorage.setItem('wiki_users', JSON.stringify(users));
    notify("–ë–∏–∑–Ω–µ—Å –∫—É–ø–ª–µ–Ω! –î–æ—Ö–æ–¥ –≤—ã—Ä–æ—Å.");
    updateUI();
  } else notify("–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ üíé");
}

function buyItem(type, value, price) {
  let users = JSON.parse(localStorage.getItem('wiki_users'));
  if (users[currentUser].diamonds >= price) {
    users[currentUser].diamonds -= price;
    if (type === 'color') users[currentUser].nickColor = value;
    if (type === 'theme') users[currentUser].bg = value;
    if (type === 'prefix') users[currentUser].prefix = value;
    localStorage.setItem('wiki_users', JSON.stringify(users));
    updateUI();
    notify("–ö—É–ø–ª–µ–Ω–æ!");
  } else notify("–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ üíé");
}

function startInfiniteQuiz() {
  shuffledQuestions = [...quizData].sort(() => Math.random() - 0.5);
  showNextQuestion();
}

function showNextQuestion() {
  if (currentQIndex >= shuffledQuestions.length) {
    shuffledQuestions = [...quizData].sort(() => Math.random() - 0.5);
    currentQIndex = 0;
  }
  const data = shuffledQuestions[currentQIndex];
  document.getElementById('question-text').innerText = data.q;
  const optBox = document.getElementById('answer-options');
  optBox.innerHTML = "";
  data.a.forEach((ans, i) => {
    const btn = document.createElement('button');
    btn.className = "answer-btn";
    btn.innerText = ans;
    btn.onclick = () => {
      if (i === data.correct) {
        let users = JSON.parse(localStorage.getItem('wiki_users'));
        users[currentUser].diamonds += 5000;
        localStorage.setItem('wiki_users', JSON.stringify(users));
        notify("–í–µ—Ä–Ω–æ! +5000 üíé");
        updateUI();
      } else notify("‚ùå –û—à–∏–±–∫–∞");
      currentQIndex++;
      showNextQuestion();
    };
    optBox.appendChild(btn);
  });
}

function initAvatarSelector() {
  const grid = document.getElementById('avatar-selector');
  grid.innerHTML = "";
  avatars.forEach(av => {
    const el = document.createElement('div');
    el.className = "avatar-item";
    el.innerText = av;
    el.onclick = () => {
      let users = JSON.parse(localStorage.getItem('wiki_users'));
      users[currentUser].avatar = av;
      localStorage.setItem('wiki_users', JSON.stringify(users));
      updateUI();
    };
    grid.appendChild(el);
  });
}

function toggleScreen(id) {
  ['auth-screen', 'game-screen', 'profile-screen', 'shop-screen', 'admin-screen'].forEach(s => document.getElementById(s).classList.add('hidden'));
  document.getElementById(id).classList.remove('hidden');
}

function adminTransfer() {
  const target = document.getElementById('admin-target-user').value;
  const amount = parseInt(document.getElementById('admin-amount').value);
  let users = JSON.parse(localStorage.getItem('wiki_users'));
  if (users[target]) {
    users[target].diamonds += amount;
    localStorage.setItem('wiki_users', JSON.stringify(users));
    notify("–ê–ª–º–∞–∑—ã –≤—ã–¥–∞–Ω—ã!");
    updateUI();
  }
}
</script>
</body>
</html>